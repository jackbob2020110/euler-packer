#version=RHEL9
# Documentation : https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/performing_an_advanced_rhel_9_installation/kickstart-commands-and-options-reference_installing-rhel-as-an-experienced-user

ignoredisk --only-use=sda

# Use CDROM installation media
cdrom

# Installation in text mode
text

# Accept the EULA
eula --agreed

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8

# Network information
network  --hostname=openeuler
network --bootproto=dhcp --noipv6 --onboot=on --device=eth0 --activate

# Initial Setup is not started the first time the system boots
firstboot --disabled

# If present, X is not configured on the installed system
skipx

# System services
services --disabled="kdump" --enabled="sshd,rsyslog,chronyd"

# Partition clearing information
clearpart --all --initlabel

# System timezone
timezone Asia/Shanghai --utc

# Disk partitioning information
autopart --nohome --nolvm --noboot

# Root password
rootpw --plaintext vagrant

# Firewall configuration
firewall --disabled

# State of SELinux
selinux --disabled

# Boot loader
bootloader --timeout=1 --location=mbr --append="net.ifnames=0 biosdevname=0"


# Reboot after the installation is successfully completed
reboot --eject
user --name=vagrant --plaintext --password vagrant
# Install packages
%packages
@^minimal-environment
openssh-clients
sudo
-fprintd-pam
-intltool
-iwl*-firmware
-microcode_ctl
%end


%post
# sudo

echo 'Defaults:vagrant !requiretty' > /etc/sudoers.d/vagrant
echo '%vagrant ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers.d/vagrant
chmod 440 /etc/sudoers.d/vagrant

rm -f /etc/sysconfig/network-scripts/ifcfg-e*
cat > /etc/sysconfig/network-scripts/ifcfg-eth0<< _EOF_
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=dhcp
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=yes
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=eth0
DEVICE=eth0
ONBOOT=yes
_EOF_
%end